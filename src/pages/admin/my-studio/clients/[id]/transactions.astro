---
import AdminLayout from '@/layouts/AdminLayout.astro'
import { TransactionsManager } from '@/components/studio/TransactionsManager'
import { supabaseAdmin } from '@/lib/supabase'
import { createSupabaseServerClient } from '@/lib/auth'

const { id } = Astro.params
const studioId = Astro.locals.studio?.id

if (!studioId) return Astro.redirect('/admin/my-studio/setup')
if (!supabaseAdmin) return Astro.redirect('/admin')

// Verificar que el cliente pertenece al estudio del superadmin
const { data: client } = await supabaseAdmin
  .from('clients')
  .select('id, name, studio_id')
  .eq('id', id)
  .eq('studio_id', studioId)
  .single()

if (!client) return Astro.redirect('/admin/my-studio/clients')

// Obtener per√≠odo activo
const supabase = createSupabaseServerClient(Astro.cookies)
const { data: activePeriod } = await supabase
  .from('reca_periods')
  .select('*')
  .eq('is_active', true)
  .single()
---

<AdminLayout title={`Transacciones - ${client.name}`}>
  <div class="space-y-6">
    <div class="flex items-center gap-4">
      <a href="/admin/my-studio/clients" class="text-muted-foreground hover:text-foreground">
        &larr; Volver a clientes
      </a>
    </div>
    <h1 class="text-2xl font-bold">Transacciones: {client.name}</h1>
    <TransactionsManager
      client:load
      clientId={client.id}
      clientName={client.name}
      activePeriod={activePeriod}
    />
  </div>
</AdminLayout>
